<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8"/>
		<title>SMS: Discounts</title>
		<!-- Bootstrap core CSS -->
		<link href="../CSS/bootstrap-4.0.0/dist/css/bootstrap.min.css" rel="stylesheet">
	</head>

	<body>
		<header class = "row">
			<!-- Fixed navbar -->
			<nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
				<a class="navbar-brand" href="#">Discounts</a>
				<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
					<span class="navbar-toggler-icon"></span>
				</button>
				<div class="collapse navbar-collapse" id="navbarCollapse">
				<ul class="navbar-nav mr-auto">
					<li class="nav-item">
						<a class="nav-link" href="./management-items.html">Items</a>
					</li>
					<li class="nav-item active">
						<a class="nav-link" href="./management-discounts.html">Discounts</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="./management-policy.html">Discount Policy</a>
					</li>
				</ul>
				</div>
			</nav>
		</header>
		<!-- Begin page content -->
		<main class="container-fluid" id="discount-main">
			<div class = "row justify-content-center" style="margin-top: 10%;">
				<div class="card" id="view-orders-field" style="width: 18rem;">
					<div class="card-body">
						<div class="form-group">
    						<input type="text" class="form-control" id="discount-field" placeholder="Enter expired discount code">
  						</div>
					  <button type="button" class="btn btn-info" onclick="viewDiscountedOrders()">View discounted orders</button>
					</div>
				</div>

				<div class="card" id="requests" style="width: 18rem;">
					<center><h5 class="card-title">Current discount requests</h5></center>
					<div class="card-body" id="request-area">
					</div>
				</div>

				<div class="card" id="add-discount-field" style="width: 18rem;">
					<div class="card-body">
						<div class="form-group">
    						<input type="text" class="form-control" id="item-field" placeholder="Enter item name">
  						</div>
					  <button type="button" class="btn btn-success" onclick="addDiscount()">Add discount</button>
					</div>
				</div>
			</div>
		</main>
		<br><br>
		<main class="container-fluid" id="report-content">
			<center><h5 class="card-title">Discounted Orders:</h5></center>
			<div class = "row justify-content-center">
				<div class="card" style="width: 54rem;">
					<div class="card-body">
					First order 
					</div>
				</div>
			</div>
			<div class = "row justify-content-center">
				<div class="card" style="width: 54rem;">
					<div class="card-body">
					Second Order
					</div>
				</div>
			</div>
		</main>
		<!-- Bootstrap core JavaScript
		================================================== -->
		<!-- Placed at the end of the document so the pages load faster -->
		<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
		<script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery-slim.min.js"><\/script>')</script>
		<script src="../CSS/bootstrap-4.0.0/assets/js/vendor/popper.min.js"></script>
		<script src="../CSS/bootstrap-4.0.0/dist/js/bootstrap.min.js"></script>
		<script src="../JS/helper.js"></script> 

		<script>
			function getDiscountCode() {
				return document.getElementById("discount-field").value;
			}

			function getItemName() {
				return document.getElementById("item-field").value;
			}

			function viewDiscountedOrders() {
				var discountCode = getDiscountCode();

				var emptyFields = [];
				if (discountCode == "") {
					emptyFields.push("discount code");
				}

				if (emptyFields.length > 0) {
					alertMissingFields(emptyFields);
					return;
				}
				
				//
				var i, content ='<center><h5 class="card-title">Discounted Orders:</h5></center>';
				var xmlhttp = new XMLHttpRequest();
				var message = `{"foo" : "discount_report", "discount_code" : "dXc17sP"}`;
				
				xmlhttp.onreadystatechange = function ()
				{
					if(this.readyState == 4 && this.status == 200)
					{
						console.log(this.responseText);
						var info = JSON.parse(this.responseText);
						console.log(info);
						var cusName, cusPhone, cusEmail, itemId, itemQuantity;
						for(i in info.orders)
						{
						cusName = info.orders[i].CusName;
						cusPhone = info.orders[i].CusPhone;
						cusEmail = info.orders[i].CusEmail;
						itemId = info.orders[i].itemId;
						itemQuantity = info.orders[i].quantity;
						itemName = info.orders[i].itemName;
						var intPrice = info.orders[i].itemPrice;
						itemPrice = "$" + intPrice.toFixed(2);
							content += `<div class = "row justify-content-center">
											<div class="card" style="width: 54rem;">
												<div class="card-body">
													<div class = "row justify-content-left">
														<div class="card" style="width: 18rem;">
															<div class="card-body">
																Customer Name: ${cusName}
																<br>
																Customer Phone #: ${cusPhone}
																<br>
																Customer Email: ${cusEmail}
															</div>
														</div>
														<div class="card" style="width: 18rem;">
															<div class="card-body">
																Item Id: ${itemId}
																<br>
																Item Name: ${itemName}
																<br>
																Item Price: ${itemPrice}
																<br>
																Quantity: ${itemQuantity}
															</div>
														</div>
														<div class="card" style="width: 17rem;">
															<div class="card-body">
																Discount stats
															</div>
														</div>
													</div>
													<div class = "row justify-content-center">
														<div class="card" style="width: 53rem;">
																<div class="card-body">
																	Order totals
																</div>
															</div>
														</div>
													</div>
												</div>
											</div>
										</div>`;
						}
						document.getElementById('report-content').innerHTML = content;
						
					}
				}
				xmlhttp.open("POST", "../../api/admin.php", true);
				xmlhttp.setRequestHeader("Content-type", 'application/json; charset=UTF-8');
				xmlhttp.send(message);
				
			}

			function addDiscount() {
				var name = getItemName();

				var emptyFields = [];
				if (name == "") {
					emptyFields.push("item name");
				}

				if (emptyFields.length > 0) {
					alertMissingFields(emptyFields);
					return;
				}
				
				
			}

			function viewRequests() {

			}
			
		</script>
	</body>
</html>
